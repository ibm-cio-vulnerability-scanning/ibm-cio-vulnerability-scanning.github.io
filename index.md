# OSS Vulnerability Scanning - Setup and workflow

[<link string>](<url>)

This guide will help you understand the general workflow of this IBM organization and how to setup WhiteSource and the GitHub action to keep up to date automatically in the repository you want to contribute to.

## Requirements

- GitHub [Access Token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token).
- GitHub [action installation SSH script](https://github.com/Toolbox-Mexico-CIO-Guadalajara-Public/open-source-sync-action-installer/raw/main/src/SyncActionInstaller.sh).

### 1. Forking the repository and activating WhiteSource

The GitHub organization already have WhiteSource installed in it and configured for all the respositories forked inside it.

1. Fork the repository you want to contribute to and select the IBM Vulnerability Scanning organization as destination:

![How to fork](https://docs.github.com/assets/cb-6294/images/help/repository/fork_button.jpg)

3. Create a new branch called 'default_clone'. This will be the base branch that we will use to change files and create PRs as the default branch will have the GitHub action installer and the WhiteSource configuration file.

2. Activate the Issues tab:

![Activate the issues tab](https://learn-the-web.algonquindesign.ca/topics/github-issues/enable-issues.jpg)

3 . A new **pull request will be automatically created by WhiteSource**, merge the PR to the original repo default branch ('master' or 'main', not the 'default_clone' you created).

Once the PR is merged, WhiteSource will start scanning this repository for CVEs vulnerabilitites and you will be **able to see them in the Issues tab**. If you want to change the min level of vulnerability score, change the LOW parameter in the .whitesource file to the value you want (MEDIUM, HIGH).

### 2. Activating the GitHub Action

1. Clone the repository to your machine using CLI or GitHub Desktop.

2. Checkout to the original default branch or the repo ('master' or 'main', not the 'default_clone' you created). 

3. Open the repo in the file explorer and drop the [action installation SSH script](https://github.com/Toolbox-Mexico-CIO-Guadalajara-Public/open-source-sync-action-installer/raw/main/src/SyncActionInstaller.sh). file in the root folder of the repository.

4. Give execution permission to the file:

```zsh
~$ chmod +x SyncActionInstaller.sh
```
5 . Execute the file.

```zsh
~$ ./SyncActionInstaller.sh
```
6 . You will be prompted to enter the following information:

- apiKeySecretName: Your GitHub personal access token (default: API_KEY)
- ownerName: The name of the original owner of the forked repo (default: IBM)
- baseBranch: The name of the default branch of the original repo (default: main)
- headBranch: The name of the forked target branch of the forked repo (default: main)

7 . After entering all the values and executing the rest of the script. A new commit will be **automatically created** with the ibm_fork_sync.yml action installed in the repository. You will be redirected to the GitHub page of the worflows of the repo, enable them if prompted.

Once the workflows are enabled, the action installer will be executed at 23:59 UTC every Monday and Friday. You can also run this action manually if needed.

If you are curious of the code behind the action, please refer to [Open Source Fork Sync](https://github.com/Toolbox-Mexico-CIO-Guadalajara-Public/open-source-fork-sync).

### 3. Create a PR

The flow for creating a PR with a CVE change is virtually the same as a normal contribution to a OSS repository.

1. Select a CVE from the Issues tab.
2. Checkout to the 'default_clone' branch and merge it with the original default branch to get the latest changes. Make sure to **delete the .whitesource file and the SyncActionInstaller.sh file in the .workflows folder** as we don't want to add them to the PR.
3. Create and publich a new branch with the following structure: fix/<THE_CVE_NAME> using the 'default_clone'.
4. Make the proper changes to the library dependencies in the code and commit them.
5. Create a PR from this branch and make sure you point to the **original owner of the repo** (ex: Google/tensorflow -> main). Do NOT do a PR in your forked code.
6. Once created, do a follow-up of the PR until it is merged into the original code.
